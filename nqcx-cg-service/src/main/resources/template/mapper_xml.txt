<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="[(${namespace})]">

	<resultMap id="[(${tableName})]_rm" type="[(${po})]">[# th:each="f : ${resultMap}"]
		[(${f})][/]
	</resultMap>

	<sql id="[(${tableName})]_columns">
		[(${idColumn})], [(${tableColumnsStr})]
	</sql>

	<insert id="save" parameterType="[(${po})]" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO [(${tableName})] (
			<include refid="[(${tableName})]_columns" />
		) VALUES (
		    NULL[# th:each="c : ${poColumns}"],
		    [(*{poFields[__${cStat.index}__]})][/]
		)
	</insert>

	<update id="update" parameterType="[(${po})]">
		UPDATE
			[(${tableName})]
		SET [# th:each="c : ${poColumns}"][# th:if="${cStat.index > 0}"],[/]
		    [(${c})]=[(*{poFields[__${cStat.index}__]})][/]
		WHERE
			[(${idColumn})]=[(${idField})]
	</update>

	<select id="findById" resultMap="[(${tableName})]_rm" parameterType="long">
		SELECT
			<include refid="[(${tableName})]_columns" />
		FROM
			[(${tableName})]
		WHERE
			[(${idColumn})]=[(${idField})]
	</select>

	<select id="findByIds" resultMap="[(${tableName})]_rm">
		SELECT
			<include refid="[(${tableName})]_columns" />
		FROM
			[(${tableName})]
		WHERE
			[(${idColumn})] IN
			<foreach item="item" index="index" collection="list"
			         open="(" separator="," close=")">
				#{item}
			</foreach>
	</select>

	<sql id="condition">
		<where>
			<if test="[(${idFieldName})] != null and [(${idFieldName})] != ''">
				[(${idColumn})]=[(${idField})]
			</if>
		</where>
	</sql>

	<select id="findAll" resultMap="[(${tableName})]_rm" parameterType="map">
		SELECT
			<include refid="[(${tableName})]_columns" />
		FROM
			[(${tableName})]
		<include refid="condition" />
		<if test="order != null">
			${order}
		</if>
		<if test="pageTag == 1">
			${position}
		</if>
	</select>

	<select id="getCount" parameterType="map" resultType="long">
		SELECT
			count(*)
		FROM
			[(${tableName})]
		<include refid="condition" />
	</select>

	<delete id="deleteById" parameterType="long">
		DELETE FROM
			[(${tableName})]
		WHERE
			[(${idColumn})]=[(${idField})]
	</delete>

	<delete id="deleteByIds">
		DELETE FROM
			[(${tableName})]
		WHERE
			[(${idColumn})] IN
			<foreach item="item" index="index" collection="list"
			         open="(" separator="," close=")">
				#{item}
			</foreach>
	</delete>
</mapper>